!function(){function init(){if(!emy.ready){emy.ready=!0;var e=document.createElement("div").style;prefix=""==e.WebkitTransform?"webkit":""==e.MozTransform?"moz":""==e.msTransform?"ms":""==e.transform?"none":null,"css"==emy.transitionMode&&(emy.transitionMode=prefix?"css":"js"),"webkit"==prefix?(emy.prefixedProperty.transform="webkitTransform",emy.prefixedProperty.transformDuration="webkitTransformDuration",emy.prefixedProperty.transitionEnd="webkitTransitionEnd",emy.prefixedProperty.animationStart="webkitAnimationStart",emy.prefixedProperty.animationDuration="webkitAnimationDuration",emy.prefixedProperty.animationEnd="webkitAnimationEnd"):"moz"==prefix?(emy.prefixedProperty.transform="MozTransform",emy.prefixedProperty.transformDuration="MozTransformDuration",emy.prefixedProperty.transitionEnd="transitionend",emy.prefixedProperty.animationStart="animationstart",emy.prefixedProperty.animationDuration="animationduration",emy.prefixedProperty.animationEnd="animationend"):"ms"==prefix?(emy.prefixedProperty.transform="msTransform",emy.prefixedProperty.transformDuration="msTransformDuration",emy.prefixedProperty.transitionEnd="transitionend",emy.prefixedProperty.animationStart="MSAnimationStart",emy.prefixedProperty.animationDuration="MSAnimationDuration",emy.prefixedProperty.animationEnd="MSAnimationEnd"):"none"==prefix&&(emy.prefixedProperty.transform="msTransform",emy.prefixedProperty.transformDuration="msTransformDuration",emy.prefixedProperty.transitionEnd="transitionend",emy.prefixedProperty.animationStart="MSAnimationStart",emy.prefixedProperty.animationDuration="MSAnimationDuration",emy.prefixedProperty.animationEnd="MSAnimationEnd");var t=emy.getSelectedView(),i=getViewFromLocation();t&&(originalView=t,emy.showView(t)),i&&i!=t&&emy.showView(i),"object"==typeof window.onorientationchange?window.onorientationchange=resizeHandler:window.onresize=resizeHandler,"onhashchange"in window?window.onhashchange=checkLocation:checkTimer=setInterval(checkLocation,300),setTimeout(function(){preloadImages(),checkLocation(),fitHeight()},1)}}function followAnchor(e){e.setAttribute("selected","true");var t=emy.gotoView(e.hash.substr(1),!1);setTimeout(function(){e.removeAttribute("selected")},t?0:500)}function followAjax(e,t){e.setAttribute("selected","progress"),emy.showViewByHref(e.href,null,"GET",t,function(){e.removeAttribute("selected")})}function sendEvent(e,t,n){if(t){var s=document.createEvent("UIEvent");if(s.initEvent(e,!1,!1),n)for(i in n)s[i]=n[i];t.dispatchEvent(s)}emy.log("event sent: "+e)}function getViewFromLocation(){var e=location.hash.substr(hashPrefix.length);return e?emy.$("#"+e):null}function resizeHandler(){fitHeight()}function checkLocation(){if(emy.log("checkLocation"),emy.log(viewHistory),location.hash!=currentHash){var e=location.hash.substr(hashPrefix.length);""==e&&originalView&&(e=originalView.id),emy.showViewById(e)}}function showDialog(e){scrollTo(0,1),currentDialog=e,e.setAttribute("selected","true"),"css"==emy.transitionMode?setTimeout(function(){emy.addClass(e,"show")},1):emy.addClass(e,"show"),showForm(e),e.onclick=function(e){e.srcElement&&emy.hasClass(e.srcElement,"dialog")&&cancelDialog(e.srcElement)}}function cancelDialog(e){"css"==emy.transitionMode?(setTimeout(function(){emy.changeClass(e,"show","")},1),e.addEventListener(emy.prefixedProperty.transitionEnd,hideForm,!1)):(emy.changeClass(e,"show",""),hideForm(e))}function showForm(e){e.addEventListener("click",function(){},!0),emy.busy=!1}function hideForm(e){emy.$("header.toolbar").style.display="",void 0==e.srcElement?e.removeAttribute("selected"):(e.srcElement.removeAttribute("selected"),e.srcElement.removeEventListener(emy.prefixedProperty.transitionEnd,hideForm,!1))}function updateView(e,t){e.id||(e.id="__"+ ++newViewCount+"__"),currentHash=hashPrefix+""+e.id,t?location.assign(currentHash):location.replace(currentHash),viewHistory.push(e.id);var i=emy.$("#viewTitle");e.getAttribute("data-title")&&(i.innerHTML=e.getAttribute("data-title")),"form"==e.localName.toLowerCase()&&showForm(e);var n=emy.$("#backButton");if(n){var s=emy.$("#"+viewHistory[viewHistory.length-2]);s&&!e.getAttribute("data-hidebackbutton")?(n.style.display="block",n.innerHTML=s.getAttribute("data-title")?s.getAttribute("data-title"):"Back"):n.style.display="none"}emy.busy=!1}function canDoSlideAnim(){return"none"!=emy.transitionMode&&null!=emy.prefixedProperty}function slideViews(fromView,toView,backwards){function slideDone(){emy.hasClass(toView,"dialog")||(fromView.removeAttribute("selected"),fromView.removeAttribute("emy-transition"),toView.removeAttribute("emy-transition")),"onhashchange"in window||(checkTimer=setInterval(checkLocation,300)),setTimeout(updateView,0,toView,fromView),fromView.removeEventListener(emy.prefixedProperty.animationEnd,slideDone,!1),fromView.getAttribute("data-onexit")&&eval(fromView.getAttribute("data-onexit")),toView.getAttribute("data-onshow")&&eval(toView.getAttribute("data-onshow")),sendEvent("aftertransition",fromView,{out:!0}),sendEvent("aftertransition",toView,{out:!1}),backwards&&sendEvent("unload",fromView)}scrollTo(0,1),clearInterval(checkTimer),sendEvent("beforetransition",fromView,{out:!0}),sendEvent("beforetransition",toView,{out:!1}),"css"==emy.transitionMode?slideCSS(fromView,toView,backwards,slideDone):"js"==emy.transitionMode?slideJS(fromView,toView,backwards,slideDone):noSlide(fromView,toView,slideDone)}function slideJS(e,t,i,n){function s(){a-=slideStep,e.style.left=(i?100-a:a-100)+"%",t.style.left=(i?-a:a)+"%",0>=a&&(clearInterval(o),a=0,n())}t.style.left="100%",scrollTo(0,1),t.setAttribute("selected","true");var a=100,o=setInterval(s,slideSpeed);s()}function slideCSS(e,t,i,n){function s(){e.setAttribute("emy-transition",o),t.setAttribute("emy-transition",r),t.style.visibility=""}if(t.style.visibility="hidden",i)var a=e.getAttribute("custom-transition")?e.getAttribute("custom-transition"):"slide";else var a=t.getAttribute("custom-transition")?t.getAttribute("custom-transition"):"slide";var o=i?a+"backout":a+"out",r=i?a+"backin":a+"in";t.setAttribute("selected","true"),e.addEventListener(emy.prefixedProperty.animationEnd,n,!1),setTimeout(s,1)}function noSlide(e,t,i){setTimeout(function(){e.removeAttribute("selected"),t.setAttribute("selected","true"),i()},1)}function submitForm(e){emy.addClass(e,"progress"),sendEvent("beforeformsubmit",document.body,{form:e}),emy.showViewByHref(e.getAttribute("action"),encodeForm(e),e.hasAttribute("method")?e.getAttribute("method"):"GET",null,function(){emy.changeClass(e,"progress",""),cancelDialog(e),sendEvent("afterformsubmit",document.body,{form:e})})}function encodeForm(e){function t(e){for(var t=0;t<e.length;++t)if(e[t].name){var n=e[t];if("checkbox"==n.getAttribute("type")&&!n.checked||"radio"==n.getAttribute("type")&&!n.checked||n.disabled)continue;if("submit"==n.getAttribute("type")){if(!n.getAttribute("submitvalue"))continue;n.removeAttribute("submitvalue")}var s=i[n.name];void 0===s?i[n.name]=n.value:s instanceof Array?s.push(n.value):i[n.name]=[s,n.value]}}var i={};return t(e.getElementsByTagName("input")),t(e.getElementsByTagName("textarea")),t(e.getElementsByTagName("select")),t(e.getElementsByTagName("button")),i}function findParent(e,t){for(;e&&(1!=e.nodeType||e.localName.toLowerCase()!=t);)e=e.parentNode;return e}function replaceElementWithFrag(e,t){var i=e.parentNode,n=i.parentNode;n.removeChild(i);for(var s;t.firstChild;)s=n.appendChild(t.firstChild),sendEvent("afterinsert",document.body,{insertedNode:s});sendEvent("afterinsertend",document.body,{fragment:t})}function preloadImages(){var e=document.createElement("div");e.id="preloader",document.body.appendChild(e)}function fitHeight(){if(window.scrollTo(0,0),0==screenHeight)var e=screenHeight;else var e=window.innerHeight;setTimeout(function(){var t,i=emy.$(".toolbar")[0].clientHeight,n=emy.$("body")[0].childNodes;if(n)for(var s=1;s<=n.length-1;s++)""==n[s].id||void 0==n[s].id||"object"!=typeof n[s]||emy.hasClass(n[s],"toolbar")||(t=e,window.navigator.standalone===!1?navigator.userAgent.toLowerCase().search("ipad")>-1?t=e:emy.hasClass(n[s],"dialog")?t=e+60:2>screenHeight&&(t=e+60):navigator.userAgent.toLowerCase().search("android")>-1&&0==screenHeight?t=e+50:navigator.userAgent.toLowerCase().search("firefox")>-1&&(t=e-i),n[s].style.minHeight=t+"px");0==screenHeight?(screenHeight=1,fitHeight()):1==screenHeight&&(screenHeight=t),setTimeout(function(){window.scrollTo(0,1)},1)},1)}var slideSpeed=10,slideStep=5,ajaxTimeoutVal=3e4,prefix=null,originalView=null,currentView=null,currentDialog=null,currentWidth=0,currentHeight=0,currentHash=location.hash,hashPrefix="#",viewHistory=[],newViewCount=0,checkTimer,screenHeight=0;window.emy={logging:!1,busy:!1,transitionMode:"css",ajaxErrHandler:null,httpHeaders:{"X-Requested-With":"XMLHttpRequest"},prefixedProperty:[],plugin:[],ready:!1,init:function(){init()},showView:function(e,t){if(e){if(e==currentView)return emy.busy=!1,void 0;if(currentDialog&&(currentDialog.removeAttribute("selected"),sendEvent("blur",currentDialog),currentDialog=null),emy.hasClass(e,"dialog"))sendEvent("focus",e),showDialog(e);else{sendEvent("load",e);var i=currentView;sendEvent("blur",currentView),currentView=e,sendEvent("focus",e),i?setTimeout(slideViews,0,i,e,t):updateView(e,i)}}},gotoView:function(e,t){var i,n;if(e instanceof HTMLElement?(i=e,n=i.id):(n=e,i=emy.$(hashPrefix+n)),i||emy.log("gotoView: node is null"),emy.busy)return!0;emy.busy=!0;var s=viewHistory.indexOf(n),a=-1!=s;return a?viewHistory.splice(s):t&&viewHistory.pop(),emy.showView(i,a),!1},showViewById:function(e){emy.gotoView(e,!1)},goBack:function(e){if(e){var t=viewHistory.length-(viewHistory.indexOf(e)+1);viewHistory=viewHistory.slice(0,viewHistory.length-t),window.history.go(-t)}else window.history.go(-1),viewHistory.pop();emy.log(viewHistory)},showViewByHref:function(e,t,i,n,s){function a(e){if(4==e.readyState){if(200!=e.status&&0!=e.status||e.aborted)emy.busy=!1,emy.ajaxErrHandler&&emy.ajaxErrHandler("Error contacting server, please try again later");else{var t=document.createElement("div");t.innerHTML=e.responseText,sendEvent("beforeinsert",document.body,{fragment:t}),n?(replaceElementWithFrag(n,t),emy.busy=!1):emy.insertViews(t)}s&&setTimeout(s,1e3,!0)}}emy.busy?s():(emy.busy=!0,emy.ajax(e,t,i,a))},ajax:function(e,t,i,n){function s(){try{a.abort(),a.aborted=!0}catch(e){emy.log(e)}}var a=new XMLHttpRequest;i=i?i.toUpperCase():"GET",t&&"GET"==i&&(e=e+"?"+emy.param(t)),a.open(i,e,!0),n&&(a.onreadystatechange=function(){n(a)});var o=null;t&&"GET"!=i&&(a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o=emy.param(t));for(var r in emy.httpHeaders)a.setRequestHeader(r,emy.httpHeaders[r]);return a.send(o),a.requestTimer=setTimeout(s,ajaxTimeoutVal),a},param:function(e){var t=[];for(var i in e){var n=e[i];if("object"==typeof n&&"number"==typeof n.length)for(var s=0;s<n.length;s++)t[t.length]=encodeURIComponent(i)+"="+encodeURIComponent(n[s]);else t[t.length]=encodeURIComponent(i)+"="+encodeURIComponent(n)}return t.join("&").replace(/%20/g,"+")},insertViews:function(e){for(var t,i=e.childNodes,n=0;n<i.length;++n){var s=i[n];if(1==s.nodeType){s.id||(s.id="__"+ ++newViewCount+"__");var a,o=emy.$("#"+s.id);o?(o.parentNode.replaceChild(s,o),a=emy.$(s.id)):a=document.body.appendChild(s),sendEvent("afterinsert",document.body,{insertedNode:a}),fitHeight(),"true"!=s.getAttribute("selected")&&t||(t=s),--n}}sendEvent("afterinsertend",document.body,{fragment:e}),t&&setTimeout(function(){emy.showView(t)},1)},getSelectedView:function(){for(var e=document.body.firstChild;e;e=e.nextSibling)if(1==e.nodeType&&"true"==e.getAttribute("selected"))return e},getAllViews:function(){var e=document.body.children,t=[];if(e){for(var i=0,n=e.length;n>i;i++)e[i].id&&e[i].getAttribute("data-title")&&t.push(e[i]);return t}return!1},isNativeUrl:function(e){for(var t=[new RegExp("^http://maps.google.com/maps?"),new RegExp("^mailto:"),new RegExp("^tel:"),new RegExp("^http://www.youtube.com/watch\\?v="),new RegExp("^http://www.youtube.com/v/"),new RegExp("^javascript:"),new RegExp("^sms:"),new RegExp("^callto:")],i=!1,n=0;n<t.length;n++)e.match(t[n])&&(i=!0);return i},hasClass:function(e,t){return e.className.indexOf(t)>-1?!0:!1},addClass:function(e,t){emy.hasClass(e,t)||(e.className+=" "+t)},changeClass:function(e,t,i){emy.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(\\s|^)"+t+"(\\s|$)"),i))},$:function(e){if("#"==e.substr(0,1))return document.getElementById(e.substr(1))?document.getElementById(e.substr(1)):null;if("."==e.substr(0,1))return document.getElementsByClassName(e.substr(1))?document.getElementsByClassName(e.substr(1)):null;if(e.indexOf(".")>-1){for(var t=document.getElementsByTagName(e.split(".")[0]),i=e.split(".")[1],n=0,s=t.length;s>n;n++)if(t[n].className.indexOf(i)>-1)return t[n]}else if(e)return document.getElementsByTagName(e)?document.getElementsByTagName(e):null},log:function(){void 0!=window.console&&1==emy.logging&&console.log.apply(console,arguments)}},addEventListener("load",init,!1),addEventListener("click",function(e){function t(){i.removeAttribute("selected")}emy.busy||"onhashchange"in window||(checkTimer=setInterval(checkLocation,300));var i=findParent(e.target,"a");if(i){if(i.href&&i.hash&&"#"!=i.hash&&!i.target)followAnchor(i);else if(i==emy.$("#backButton"))i.setAttribute("selected","true"),setTimeout(function(){t()},300),emy.goBack();else if("submit"==i.getAttribute("type")){var n=findParent(i,"form");if("_self"==n.target)return"function"==typeof n.onsubmit?1==n.onsubmit()&&n.submit():n.submit(),void 0;submitForm(n)}else if("cancel"==i.getAttribute("type"))i.setAttribute("selected","true"),setTimeout(function(){t()},300),cancelDialog(findParent(i,"section"));else if("_replace"==i.target)followAjax(i,i);else{if(emy.isNativeUrl(i.href))return;if("_webapp"==i.target)location.href=i.href;else if(!i.target&&i.getAttribute("href"))followAjax(i,null);else if(""!=i.getAttribute("href"))return}e.preventDefault()}var s=findParent(e.target,"div");if(s&&emy.hasClass(s,"toggle")){var a=s.getAttribute("toggled");null!=a?s.removeAttribute("toggled"):s.setAttribute("toggled","");for(var o=s.childNodes,r=0;r<o.length;++r)1==o[r].nodeType&&null!=o[r].getAttribute("type")&&(o[r].value=null==a);e.preventDefault()}var l=findParent(e.target,"input");l&&"submit"==l.type&&l.setAttribute("submitvalue",l.value)},!0),addEventListener("submit",function(e){var t=e.target;"_self"!=t.target&&(e.preventDefault(),submitForm(t))},!0)}();